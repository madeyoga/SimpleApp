{% extends "base.html" %}

{% load static %}

{% block header %}
  <link href="{% static 'ijazah/css/small-business.css' %}" rel="stylesheet">
  <link href="{% static 'ijazah/vendor/bootstrap/css/bootstrap.min.css' %} " rel="stylesheet">
{% endblock %}

{% block content %}

  <!-- Page Content -->
  <div class="container">

    <!-- Heading Row -->
    <div class="row align-items-center my-5">
      <div class="col-lg-7" style="text-align: center;">
        <img id='preview-ijazah' style= 'width: 425px; height: 550px' class="img-fluid rounded mb-4 mb-lg-0" src="http://placehold.it/425x550" alt="">
      </div>
      <!-- /.col-lg-8 -->
      <div class="col-lg-5">
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <h1 class="font-weight-light">Upload Ijazah</h1>
          <p>This is a template that is great for small businesses. It doesn't have too much fancy flare to it, but it makes a great use of the standard Bootstrap core components. Feel free to use this template for any project you want!</p>
          <div class='row'>
            <div class='col-lg-9'>
              <div class='custom-file'>
                <input id='inputGroupFile' class='custom-file-input' type='file' name='gambar'>
                <label class='custom-file-label'>Choose File</label>
              </div>
            </div>
            <button class="btn btn-primary col-lg-3" type="submit">Upload</button>
          </div>
        </form>
      </div>
      <!-- /.col-md-4 -->
    </div>
    <!-- /.row -->

    <!-- Call to Action Well -->
    <div class="card text-white bg-secondary my-5 py-4 text-center">
      <div class="card-body">
        <p class="text-white m-0">This call to action card is a great place to showcase some important information or display a clever tagline!</p>
      </div>
    </div>

    <!-- Content Row -->
    {% if segmented_image_urls %}
      <div class='row'>
        {% for url in segmented_image_urls %}
          <div class="col-md-12 mb-5">
            <div class="card h-100">
              <div class="card-body">
                <img class="card-img-top" src="{{url}}" style="object-fit: cover;">
                <h2 class="card-title">Card One</h2>
                <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Rem magni quas ex numquam, maxime minus quam molestias corporis quod, ea minima accusamus.</p>
                <div class='row'>
                  <div class='col-md-2'>
                    <h5>Metode</h5>
                    <select id="method-{{url}}" aria-labelledby="dropdownMenu2">
                      <option type="button">Digit</option>
                      <option type="button">Character</option>
                      <option type="button">Text</option>
                    </select>
                  </div>
                  <div class='col-md-2'>
                    <h5>Walk</h5>
                    <select id="walk-{{url}}" aria-labelledby="dropdownMenu2">
                      <option type="button">0</option>
                      <option type="button">1</option>
                    </select>
                  </div>
                  <div class='col-md-2'>
                    <h5>Result</h5>
                    <input id='res-{{url}}' type="text" name="result-{{url}}" disabled>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <button onclick='request_recognition("{{url}}", document.getElementById("method-{{url}}").value, document.getElementById("walk-{{url}}").value)' class="btn btn-primary btn-sm">Recognize</button>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

  </div>
  <!-- /.container -->

  <script>
      $(document).ready(function () {
        $('#demolist a').on('click', function () {
          var txt= ($(this).text());
          alert("Your Favourite Sports is "+txt);
        });
      });

      function readURL(input) {
        if (input.files && input.files[0]) {
          var reader = new FileReader();
          
          reader.onload = function(e) {
            $('#preview-ijazah').attr('src', e.target.result);
          }
          
          reader.readAsDataURL(input.files[0]); // convert to base64 string
        }
      }
      $('#inputGroupFile').on('change',function(){
          //get the file name
          var fileName = $(this).val();
          //replace the "Choose a file" label
          $(this).next('.custom-file-label').html(fileName);
          readURL(this);
      })
      function request_recognition(url, method, walk) {
        console.log(url, method, walk);
        $.ajax({
            url: 'ajax/recognize/?url=' + url + '&method=' + method + '&walk=' + walk,
            dataType: 'json',
            headers: {
                'Access-Control-Allow-Origin': '*',
            },
            success: function (data) {
                console.log(data);
                resElement = document.getElementById('res-' + url);
                resElement.value = data['result'];
            }
        });
      }
  </script>
{% endblock %}

{% block foot %}
  <script src="{% static 'ijazah/vendor/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'ijazah/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
{% endblock %}